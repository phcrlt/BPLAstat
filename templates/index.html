<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аналитика полетов БПЛА</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="header">
        <div class="header-content">
            <h1><i class="fas fa-satellite"></i> Аналитика полетов БПЛА</h1>
            <p>Интерактивный сервис для анализа количества и длительности полетов гражданских беспилотников в регионах Российской Федерации</p>
        </div>
    </div>
    
    <div id="container">
        <!-- Боковая панель управления -->
        <div id="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-cogs"></i> Управление</h3>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-section">
                    <h4>Аналитика</h4>
                    <div class="nav-item active" onclick="showSection('analytics')">
                        <i class="fas fa-chart-line"></i>
                        <span>Аналитика регионов</span>
                    </div>
                    <div class="nav-item" onclick="showSection('overview')">
                        <i class="fas fa-chart-bar"></i>
                        <span>Общая аналитика</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <h4>Загрузка данных</h4>
                    <div class="nav-item" onclick="openUploadModal()">
                        <i class="fas fa-map"></i>
                        <span>Загрузить карту</span>
                    </div>
                    <div class="nav-item" onclick="openFlightsUploadModal()">
                        <i class="fas fa-plane"></i>
                        <span>Загрузить полеты</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Основной контент -->
        <div id="main-content">
            <!-- Раздел аналитики регионов -->
            <div id="analytics-section" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-chart-line"></i> Аналитика полетов по регионам</h2>
                    <p>Интерактивная карта и статистика полетов БПЛА по регионам России</p>
                </div>

                <!-- Поисковая строка -->
                <div class="search-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="regionSearch" placeholder="Поиск региона..." autocomplete="off">
                        <button class="search-clear" id="searchClear">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="search-suggestions" id="searchSuggestions"></div>
                </div>
                
                <!-- Карта -->
                <div class="map-wrapper">
                    <div id="map">
                        <div class="welcome-message">
                            <i class="fas fa-map-marked-alt"></i>
                            <h3>Добро пожаловать в систему анализа полетов БПЛА</h3>
                            <p>Загрузите GeoJSON или Shapefile для построения интерактивной карты регионов</p>
                            <button class="btn-primary" onclick="openUploadModal()">
                                <i class="fas fa-file-upload"></i> Загрузить данные карты
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Информация о регионе -->
                <div id="info" class="region-info">
                    <div class="info-content">
                        <div class="welcome-region-message">
                            <i class="fas fa-map-marker-alt"></i>
                            <h3>Выберите регион</h3>
                            <p>на карте для просмотра детальной информации о полетах</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Раздел общей аналитики -->
            <div id="overview-section" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-chart-bar"></i> Общая аналитика по всем регионам</h2>
                    <p>Сводная статистика и рейтинги регионов по различным метрикам полетов БПЛА</p>
                </div>

                    <!-- Общая статистика -->
                    <div class="overview-stats">
                        <div class="stats-grid">
                            <div class="stat-card large">
                                <div class="stat-icon">
                                    <i class="fas fa-plane"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="total-flights">0</div>
                                    <div class="stat-label">Всего полетов</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="avg-duration">0</div>
                                    <div class="stat-label">Ср. длительность (мин)</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="active-regions">0</div>
                                    <div class="stat-label">Активных регионов</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="total-hours">0</div> <!-- Изменил id -->
                                    <div class="stat-label">Общее время (ч)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- Топ регионов -->
                <div class="top-regions-container">
                    <div class="top-regions-column">
                        <h3><i class="fas fa-trophy"></i> Топ-10 регионов по количеству полетов</h3>
                        <div class="top-list" id="top-flights-list">
                            <!-- Заполнится JavaScript -->
                        </div>
                    </div>
                    <div class="top-regions-column">
                        <h3><i class="fas fa-clock"></i> Топ-10 регионов по средней длительности</h3>
                        <div class="top-list" id="top-duration-list">
                            <!-- Заполнится JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Фильтр и список всех регионов -->
                <div class="all-regions-container">
                    <div class="filter-controls">
                    <h3><i class="fas fa-filter"></i> Фильтр метрик</h3>
                    <div class="filter-options">
                        <select id="metric-filter" class="metric-select">
                            <option value="all">Все метрики</option>
                            <option value="flight_count">Количество полетов</option>
                            <option value="avg_duration_minutes">Средняя длительность</option>
                            <option value="total_duration_minutes">Общее время полетов</option>
                            <option value="avg_daily_flights">Среднее количество в день</option>
                            <option value="flight_density">Плотность полетов</option>
                            <option value="peak_load_per_hour">Пиковая нагрузка</option>
                        </select>
                        <button class="btn-filter" onclick="loadAllRegionsMetrics()">
                            <i class="fas fa-sync-alt"></i> Обновить
                        </button>
                    </div>
                </div>
                    
                    <div class="regions-table-container">
                        <table class="regions-table" id="regions-table">
                            <thead>
                                <tr>
                                    <th>Регион</th>
                                    <th>Количество полетов</th>
                                    <th>Ср. длительность (мин)</th>
                                    <th>Общее время (ч)</th>
                                    <th>Плотность</th>
                                    <th>Пиковая нагрузка</th>
                                </tr>
                            </thead>
                            <tbody id="regions-table-body">
                                <!-- Заполнится JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно загрузки карты -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUploadModal()">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-file-upload"></i> Загрузка данных карты</h2>
            </div>
            <div class="modal-body">
                <div class="drop-zone" id="dropZone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Перетащите файл сюда или нажмите для выбора</p>
                    <p><span class="highlight">Поддерживаются файлы .geojson, .shp, .zip</span></p>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".geojson,.json,.shp,.zip" style="display: none;">
                
                <div class="file-info" id="fileInfo" style="display: none;">
                    <p><strong>Выбранный файл:</strong> <span id="fileName"></span></p>
                    <p><strong>Размер:</strong> <span id="fileSize"></span></p>
                    <p><strong>Тип:</strong> <span id="fileType"></span></p>
                </div>
                
                <div class="progress-bar" id="progressBar" style="display: none;">
                    <div class="progress" id="progress"></div>
                </div>
                
                <div class="upload-status" id="uploadStatus"></div>
            </div>
            <div class="upload-actions">
                <button class="cancel-btn" onclick="closeUploadModal()">Отмена</button>
                <button class="upload-btn-action" id="uploadBtn" onclick="uploadFile()" disabled>Загрузить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно загрузки данных о полетах -->
    <div id="flightsUploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeFlightsUploadModal()">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-file-upload"></i> Загрузка данных о полетах</h2>
            </div>
            <div class="modal-body">
                <div class="drop-zone" id="flightsDropZone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Перетащите файл сюда или нажмите для выбора</p>
                    <p><span class="highlight">Поддерживаются файлы .xlsx, .xls</span></p>
                </div>
                <input type="file" id="flightsFileInput" class="file-input" accept=".xlsx,.xls" style="display: none;">
                
                <div class="file-info" id="flightsFileInfo" style="display: none;">
                    <p><strong>Выбранный файл:</strong> <span id="flightsFileName"></span></p>
                    <p><strong>Размер:</strong> <span id="flightsFileSize"></span></p>
                    <p><strong>Тип:</strong> <span id="flightsFileType"></span></p>
                </div>
                
                <div class="progress-bar" id="flightsProgressBar" style="display: none;">
                    <div class="progress" id="flightsProgress"></div>
                </div>
                
                <div class="upload-status" id="flightsUploadStatus"></div>
            </div>
            <div class="upload-actions">
                <button class="cancel-btn" onclick="closeFlightsUploadModal()">Отмена</button>
                <button class="upload-btn-action" id="flightsUploadBtn" onclick="uploadFlightsFile()" disabled>Загрузить</button>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
</body>
</html>